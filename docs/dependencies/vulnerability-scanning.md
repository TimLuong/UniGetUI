# Vulnerability Scanning

## Overview

This document describes the security scanning tools, processes, and procedures used in the UniGetUI project to identify and remediate vulnerabilities in dependencies, code, and configurations.

## Security Scanning Tools

### WhiteSource/Mend

**Status**: ✅ Active

#### Overview
WhiteSource (now Mend) is the primary dependency vulnerability scanning tool used in the UniGetUI project. It automatically scans all direct and transitive dependencies for known security vulnerabilities.

#### Configuration
- **Location**: `.whitesource`
- **Scan Frequency**: On every commit and pull request
- **Coverage**: All NuGet packages (direct and transitive)
- **Check Run**: Configured to fail builds on vulnerable dependencies

#### Configuration Details
```json
{
  "scanSettings": {
    "baseBranches": []  // Scans all branches
  },
  "checkRunSettings": {
    "vulnerableCheckRunConclusionLevel": "failure",  // Fails CI on vulnerabilities
    "displayMode": "diff",  // Shows only new issues
    "useMendCheckNames": true
  },
  "issueSettings": {
    "minSeverityLevel": "LOW",  // Reports all severity levels
    "issueType": "DEPENDENCY"  // Focuses on dependency issues
  }
}
```

#### Severity Levels

| Severity | Action Required | Response Time |
|----------|----------------|---------------|
| **Critical** | Immediate fix or removal | Within 24 hours |
| **High** | Fix in current sprint | Within 1 week |
| **Medium** | Plan fix in next sprint | Within 2-4 weeks |
| **Low** | Review and plan remediation | Within 1-2 months |

#### Alert Response Process

1. **Alert Notification**
   - Mend creates check run on PR/commit
   - Alerts visible in GitHub Security tab
   - Email notification to repository maintainers

2. **Initial Assessment** (within 4 hours for Critical/High)
   - Review vulnerability details and CVE
   - Check affected components
   - Assess exploitability in UniGetUI context
   - Determine if workaround exists

3. **Prioritization**
   - Critical/High: Immediate action
   - Medium: Next sprint planning
   - Low: Backlog for future update

4. **Remediation**
   - Update to patched version (preferred)
   - Apply workaround if patch unavailable
   - Replace package if unmaintained
   - Document false positives with justification

5. **Verification**
   - Re-run Mend scan
   - Verify vulnerability resolved
   - Test affected functionality
   - Document resolution in issue tracker

### CodeQL

**Status**: ✅ Active

#### Overview
CodeQL is GitHub's semantic code analysis engine that identifies security vulnerabilities in source code. It performs deep static analysis to find security issues, bugs, and code quality problems.

#### Configuration
- **Location**: `.github/workflows/codeql.yml`
- **Scan Frequency**: Weekly (Mondays at midnight) + on-demand
- **Languages**: C# and Python
- **Build Mode**: None (automatic extraction)

#### Workflow Configuration
```yaml
name: "CodeQL"
on:
  schedule:
    - cron: '0 0 * * 1'  # Weekly on Monday
  workflow_dispatch:  # Manual trigger available

jobs:
  analyze:
    strategy:
      matrix:
        language: [csharp, python]
        build-mode: [none]
```

#### Query Suites

CodeQL can be configured with different query suites:

1. **Default** (currently active)
   - Standard security and quality queries
   - Balanced performance and coverage

2. **Security-Extended** (available)
   - Additional security-focused queries
   - Lower precision, more false positives
   - Useful for comprehensive security reviews

3. **Security-and-Quality** (available)
   - Security + code quality queries
   - Most comprehensive
   - Longer scan times

#### Enabling Extended Queries

To enable additional query suites, uncomment in `.github/workflows/codeql.yml`:

```yaml
- name: Initialize CodeQL
  uses: github/codeql-action/init@v4
  with:
    languages: ${{ matrix.language }}
    queries: security-extended,security-and-quality  # Uncomment this line
```

#### Alert Categories

CodeQL identifies various vulnerability types:

| Category | Examples |
|----------|----------|
| **Injection** | SQL injection, command injection, XSS |
| **Cryptography** | Weak algorithms, insecure random numbers |
| **Authentication** | Broken authentication, session management |
| **Resource Management** | Memory leaks, resource exhaustion |
| **Error Handling** | Information disclosure, improper error handling |
| **Concurrency** | Race conditions, deadlocks |
| **Code Quality** | Dead code, unreachable code, complexity |

#### Alert Review Process

1. **Alert Creation**
   - CodeQL creates alerts in GitHub Security tab
   - Available at: `https://github.com/TimLuong/UniGetUI/security/code-scanning`
   - Email notification for new high-severity alerts

2. **Triage** (within 1 week)
   - Review alert details and code location
   - Assess severity and impact
   - Check for false positives
   - Assign to developer

3. **Remediation**
   - Fix identified vulnerability
   - Add code comments explaining fix
   - Write test to prevent regression
   - Document in PR description

4. **Dismissal** (for false positives only)
   - Document reason for dismissal
   - Add code comment explaining why it's safe
   - Require second reviewer approval
   - Periodically review dismissed alerts

### Renovate Bot

**Status**: ✅ Active

#### Overview
Renovate automatically creates pull requests to update dependencies, helping maintain up-to-date packages and reducing security vulnerabilities from outdated dependencies.

#### Configuration
- **Location**: `.github/renovate.json`
- **Enabled Managers**: NuGet only
- **Features**: Dependency Dashboard, automated PRs

#### Configuration Details
```json
{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": ["config:recommended"],
  "enabledManagers": ["nuget"],
  "dependencyDashboard": true
}
```

#### Dependency Dashboard

Renovate creates and maintains an issue titled "Dependency Dashboard" that:
- Lists all available updates
- Groups updates by type (major, minor, patch)
- Shows pending PRs
- Allows manual trigger of updates

**Access**: Issues tab → "Dependency Dashboard"

#### Update Strategy

Renovate follows these principles:

1. **Separate PRs**: Each major update gets its own PR
2. **Grouped PRs**: Minor/patch updates may be grouped
3. **Respect Stability**: Waits for package stability (3 days by default)
4. **Auto-merge**: Not enabled; all updates require review

#### Handling Renovate PRs

1. **Review PR Details**
   - Check release notes linked in PR
   - Review dependency changes
   - Look for breaking changes

2. **Security Check**
   - Verify Mend scan passes
   - Check for new vulnerabilities
   - Review license changes

3. **Testing**
   - Ensure CI/CD passes
   - Perform manual testing if needed
   - Check for behavior changes

4. **Merge or Decline**
   - Merge if all checks pass
   - Decline with reason if not suitable
   - Request changes if issues found

### Dependabot

**Status**: ✅ Active (GitHub Actions only)

#### Overview
GitHub's Dependabot monitors dependencies and creates automated security updates. Currently configured for GitHub Actions only.

#### Configuration
- **Location**: `.github/dependabot.yml`
- **Scope**: GitHub Actions workflows
- **Frequency**: Weekly

#### Configuration Details
```yaml
version: 2
updates:
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
    groups:
      actions-deps:
        patterns: ["*"]  # Groups all action updates together
```

#### Why Not NuGet?

Dependabot is not enabled for NuGet packages because:
- Renovate provides superior NuGet support
- Avoiding duplicate update PRs
- Renovate's dependency dashboard is more comprehensive
- Better configuration options in Renovate

#### Dependabot vs Renovate

| Feature | Dependabot | Renovate |
|---------|------------|----------|
| **NuGet Support** | Basic | Advanced |
| **Dashboard** | No | Yes |
| **Grouping** | Limited | Flexible |
| **Configuration** | Simple | Powerful |
| **Our Usage** | GitHub Actions | NuGet packages |

### DeepSource

**Status**: ⚠️ Configured but not actively used for .NET

#### Overview
DeepSource is a code quality and security analysis platform. While configured in the repository, it's primarily set up for Python and JavaScript, not for C#/.NET.

#### Configuration
- **Location**: `.deepsource.toml`
- **Enabled Analyzers**: Python, JavaScript
- **Enabled Transformers**: None (all disabled)

#### Current Status

The `.deepsource.toml` configuration exists but does not include C# analysis:
- ✅ Python analyzer enabled
- ✅ JavaScript analyzer enabled
- ❌ C# analyzer not configured

#### Recommendation

Since CodeQL provides comprehensive C# analysis and Mend covers dependencies, DeepSource is redundant for this project. Consider:
- Remove `.deepsource.toml` if not using Python/JavaScript analysis
- Or enable C# analyzer if additional analysis is desired

---

## Vulnerability Response Workflow

### 1. Detection

Vulnerabilities are detected through:
- ✅ WhiteSource/Mend automated scans (dependencies)
- ✅ CodeQL weekly scans (code)
- ✅ Renovate update PRs (outdated packages)
- ✅ Manual security reviews
- ✅ GitHub Security Advisories notifications

### 2. Notification

When a vulnerability is detected:
- Alert appears in GitHub Security tab
- Email notification sent to maintainers
- Check run fails on PR (Mend)
- Issue created in repository (CodeQL)

### 3. Triage

**Priority Assignment** (within 4 hours for Critical/High):

| Severity | Exploitable | Public Exploit | Response Time |
|----------|-------------|----------------|---------------|
| Critical | Yes | Yes | 24 hours |
| Critical | Yes | No | 48 hours |
| High | Yes | Yes | 3 days |
| High | No | No | 1 week |
| Medium | - | - | 2-4 weeks |
| Low | - | - | 1-2 months |

**Triage Questions**:
1. Is the vulnerability exploitable in our use case?
2. Does it affect functionality we use?
3. Is there a workaround available?
4. Is a patch available?
5. Can we replace the package?

### 4. Remediation

#### Option 1: Update Package (Preferred)
```bash
# Update to patched version
dotnet add package VulnerablePackage --version X.Y.Z

# Verify fix
dotnet restore
dotnet build
dotnet test
```

#### Option 2: Apply Workaround
- Document workaround in code comments
- Add to known issues in documentation
- Set reminder to check for patch
- Monitor package updates

#### Option 3: Replace Package
- Find alternative package
- Evaluate new package against criteria
- Migrate code to new package
- Test thoroughly
- Remove old package

#### Option 4: Accept Risk (Rare)
- Document why vulnerability is not applicable
- Get approval from security team/lead
- Add to accepted risks register
- Set review date
- Monitor for changes

### 5. Verification

After remediation:
1. ✅ Re-run security scans
2. ✅ Verify vulnerability resolved
3. ✅ Run full test suite
4. ✅ Perform manual testing of affected features
5. ✅ Update documentation
6. ✅ Close security issue with details

### 6. Documentation

Document the incident:
- CVE number and description
- Affected component and version
- Remediation action taken
- Testing performed
- Resolution date
- Lessons learned

---

## Manual Security Testing

### Dependency Vulnerability Check

```bash
# Check for vulnerable packages
dotnet list package --vulnerable

# Include transitive dependencies
dotnet list package --vulnerable --include-transitive

# Check for deprecated packages
dotnet list package --deprecated

# Check for outdated packages
dotnet list package --outdated
```

### Package License Audit

```bash
# List all packages with versions
dotnet list package > packages.txt

# Review licenses manually or use tool
# Note: License information not exposed by dotnet CLI by default
```

### Security Best Practices Check

Manual code review for:
- [ ] Hard-coded secrets or credentials
- [ ] SQL injection vulnerabilities
- [ ] Cross-site scripting (XSS) potential
- [ ] Insecure deserialization
- [ ] Weak cryptography usage
- [ ] Insufficient input validation
- [ ] Improper error handling
- [ ] Insecure file operations
- [ ] Command injection possibilities

---

## Security Scanning in CI/CD

### Pull Request Checks

Every pull request triggers:
1. **Mend Scan**
   - Scans for new vulnerable dependencies
   - Fails if critical/high vulnerabilities found
   - Shows diff of security posture

2. **Build and Test**
   - Compiles code with all analyzers enabled
   - Runs code analysis rules (CA rules)
   - Executes unit test suite

### Scheduled Scans

1. **CodeQL** (Weekly)
   - Full code analysis
   - Security and quality checks
   - Scans both C# and Python

2. **Dependency Updates** (Weekly)
   - Renovate checks for updates
   - Creates PRs for outdated packages
   - Updates dependency dashboard

### On-Demand Scans

Manually trigger scans:
1. **CodeQL**: Actions → CodeQL → Run workflow
2. **Renovate**: Comment `@renovatebot rebase` on any Renovate PR
3. **Mend**: Push any commit or open PR

---

## Reporting Security Issues

### GitHub Security Advisories

For reporting vulnerabilities found in UniGetUI:

1. **Navigate to Security Tab**
   - Go to: `https://github.com/TimLuong/UniGetUI/security`
   - Click "Report a vulnerability"

2. **Private Disclosure**
   - Report is private until published
   - Only maintainers can see
   - Includes vulnerability details

3. **Information to Include**
   - Vulnerability description
   - Steps to reproduce
   - Impact assessment
   - Suggested fix (if any)
   - Your contact information

### Security Policy

See `SECURITY.md` in repository root for:
- Supported versions
- Reporting guidelines
- Expected response times
- Security contact information

---

## Compliance and Auditing

### Security Audit Schedule

| Activity | Frequency | Responsible |
|----------|-----------|-------------|
| Dependency vulnerability scan | Continuous | Automated (Mend) |
| Code security scan | Weekly | Automated (CodeQL) |
| Manual dependency review | Monthly | Development team |
| Security policy review | Quarterly | Security lead |
| Comprehensive security audit | Annually | External auditor |

### Audit Checklist

#### Monthly Dependency Review
- [ ] Review all Mend alerts
- [ ] Check for outdated packages
- [ ] Verify all dependencies still needed
- [ ] Review license compliance
- [ ] Update approved-packages.md

#### Quarterly Security Review
- [ ] Review all CodeQL alerts
- [ ] Check dismissed alerts still valid
- [ ] Review security policies and processes
- [ ] Update security documentation
- [ ] Train team on new security practices

#### Annual Comprehensive Audit
- [ ] Full code security review
- [ ] Penetration testing (if applicable)
- [ ] Third-party security audit
- [ ] Review all security incidents
- [ ] Update security policies
- [ ] Compliance verification

---

## Security Metrics

### Key Performance Indicators (KPIs)

1. **Mean Time to Detect (MTTD)**
   - Target: < 1 day
   - Current: Real-time (automated scanning)

2. **Mean Time to Respond (MTTR)**
   - Critical: < 24 hours
   - High: < 7 days
   - Medium: < 30 days

3. **Vulnerability Backlog**
   - Target: < 5 open vulnerabilities
   - Priority: 0 critical, 0 high

4. **Dependency Freshness**
   - Target: < 90 days behind latest stable
   - Measured monthly

### Tracking Security Metrics

Use GitHub Security tab to track:
- Open vulnerability alerts
- Alert trends over time
- Time to remediation
- Alert severity distribution

---

## Tools and Resources

### Internal Tools
- GitHub Security Tab: `https://github.com/TimLuong/UniGetUI/security`
- Renovate Dashboard: Issues → "Dependency Dashboard"
- CodeQL Results: Security → Code scanning alerts

### External Resources
- [GitHub Advisory Database](https://github.com/advisories)
- [NuGet Package Vulnerabilities](https://github.com/dotnet/announcements/issues?q=is%3Aopen+is%3Aissue+label%3ASecurity)
- [CVE Database](https://cve.mitre.org/)
- [NIST NVD](https://nvd.nist.gov/)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)

### CLI Tools

```bash
# .NET security tools
dotnet list package --vulnerable
dotnet list package --deprecated
dotnet list package --outdated

# NuGet vulnerability check (requires dotnet-outdated tool)
dotnet tool install --global dotnet-outdated-tool
dotnet outdated --include-transitive

# License checking (third-party tool)
dotnet tool install --global dotnet-project-licenses
dotnet-project-licenses --input src/
```

---

## Best Practices

### DO

✅ Run security scans on every PR  
✅ Address critical/high vulnerabilities immediately  
✅ Keep dependencies up-to-date  
✅ Review security advisories weekly  
✅ Document security decisions  
✅ Test after security updates  
✅ Use automated scanning tools  
✅ Follow responsible disclosure  
✅ Maintain security documentation  
✅ Train team on security practices  

### DON'T

❌ Ignore security alerts  
❌ Disable security checks in CI  
❌ Use packages with known vulnerabilities  
❌ Commit secrets or credentials  
❌ Accept risks without documentation  
❌ Skip testing security fixes  
❌ Dismiss alerts without review  
❌ Deploy with known critical vulnerabilities  
❌ Ignore outdated dependencies  
❌ Bypass security policies  

---

## Related Documentation

- [Package Guidelines](./package-guidelines.md) - Dependency management standards and guidelines
- [Approved Packages](./approved-packages.md) - List of approved packages and their usage
- [SECURITY.md](../../SECURITY.md) - Security policy and reporting guidelines

## Maintenance

This document should be updated:
- ✅ When security tools are added/removed
- ✅ When security processes change
- ✅ When new vulnerabilities are discovered
- ✅ After security incidents
- ✅ During quarterly security reviews

**Document Owner**: Security Team / Development Lead  
**Review Cycle**: Quarterly  
**Last Review**: 2025-11-05  
**Next Review**: 2025-02-05
